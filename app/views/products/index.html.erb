<div class='w-full h-full max-w-lg mx-auto mb-20'>
  <div class="sticky top-0 z-10 w-full bg-white" data-controller="scroll">
    <div class="flex justify-center gap-8 py-4">
      <% @categories.each do |category| %>
        <% next if category.products.blank? %>
        <%= link_to category.name, "#category-#{category.id}", class: "text-sm font-medium text-gray-700 hover:text-gray-900", data: { turbo_frame: "_top", controller: "scroll", action: "click->scroll#scrollToCategory" } %>
      <% end %>
      <%= link_to "Viños", "#viños", class: "text-sm font-medium text-gray-700 hover:text-gray-900", data: { turbo_frame: "_top", controller: "scroll", action: "click->scroll#scrollToCategory" } %>
    </div>
  </div>
  <div class="space-y-4 p-3">
    <% @categories.each do |category| %>
      <% products = category.products.where(active: true) %>
      <% next if products.blank? %>
        <h2 class="text-3xl font-semibold text-blue-950 mb-2 px-4 text-center" id="category-<%= category.id %>"><%= category.name %></h2>
        <% products.each do |product| %>
          <%= link_to product, data: { turbo_frame: "modal" } do %>
            <div class='flex justify-between p-4 border-t animate__animated animate__fadeIn animate__fast'>
              <div class="title price flex flex-col max-w-[75%]">
                <p class='text-xl playfare font-medium'> <%= product.title %></p>
                <p class='font-light text-slate-800 lato'><%= truncate(product.description, length: 75, separator: ' ', omission: '...') %></p>
                <small class='text-[8px] text-cyan-700 '>ver detalles</small>
              </div>
              <div class="text-xl self-center">
                <%= number_with_precision(product.prize, precision: 2, separator: ',') %><small class='text-black text-base font-extralight'>€</small>
              </div>
            </div>
          <% end %>
        <% end %>
    <% end %>
    <% if Wine.where(active: true).exists? %>
      <h2 class="text-3xl font-semibold text-blue-950 mb-2 px-4 text-center" id='viños'>Viños</h2>
    <% end %>
    <% ['Blanco', 'Tinto'].each do |color| %>
      <% next if Wine.where(wine_type: color).where(active: true).empty? %>
      <h2 class="text-2xl font-semibold text-blue-950 mb-2 px-4"><%= color %>s</h2>
      <% @denominations.each do |denomination| %>
        <% wines = denomination.wines.where(active: true).where(wine_type: color) %>
        <% next if wines.blank? %>
          <h2 class="text-2xl font-medium text-slate-600 mb-2 px-4" id="category-<%= denomination.id %>"><%= denomination.name %></h2>
          <% wines.each do |wine| %>
            <%= link_to wine, data: { turbo_frame: "modal" } do %>
              <div class='flex justify-between p-4 border-t animate__animated animate__fadeIn animate__fast'>
                <div class="title price flex flex-col max-w-[75%]">
                  <p class='text-xl playfare font-medium'> <%= wine.name %></p>
                  <p class='font-light text-slate-800 lato'><%= truncate(wine.description, length: 50, separator: ' ', omission: '...') %></p>
                  <% if wine.price_per_glass %>
                    <div class="flex gap-2">
                      <span class='font-thin text-xs self-end'>Dispoñible por copa:</span>
                      <p class='font-light lato self-end' id='per_glass'><%= number_to_currency(wine.price_per_glass, { unit: '€', separator: ',', format: "%n %u" }) %></p>
                    </div>
                  <% end %>
                  <small class='text-[8px] text-cyan-700 '>ver detalles</small>
                </div>
                <div class="text-xl self-center">
                  <%= number_with_precision(wine.price, precision: 2, separator: ',') %><small class='text-black text-base font-extralight'>€</small>
                </div>
              </div>
            <% end %>
          <% end %>
      <% end %>
    <% end %>
    <%= turbo_frame_tag :modal %>

  </div>

</div>
